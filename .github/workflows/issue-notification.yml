name: Issue Notification to Slack

on:
  issues:
    types: [opened]

jobs:
  notify-slack:
    runs-on: ubuntu-latest
    steps:
      - name: Get issue label emoji
        id: label-emoji
        run: |
          labels="${{ join(github.event.issue.labels.*.name, ',') }}"
          echo "labels=$labels" >> $GITHUB_OUTPUT
          
          if [[ "$labels" == *"ğŸ”§ Fix"* ]]; then
            echo "emoji=ğŸ”§" >> $GITHUB_OUTPUT
            echo "color=#ff6b6b" >> $GITHUB_OUTPUT
            echo "type=ìˆ˜ì •" >> $GITHUB_OUTPUT
          elif [[ "$labels" == *"âœ¨ Feature"* ]]; then
            echo "emoji=âœ¨" >> $GITHUB_OUTPUT
            echo "color=#4ecdc4" >> $GITHUB_OUTPUT
            echo "type=ê¸°ëŠ¥" >> $GITHUB_OUTPUT
          elif [[ "$labels" == *"ğŸ“– Docs"* ]]; then
            echo "emoji=ğŸ“–" >> $GITHUB_OUTPUT
            echo "color=#95a5a6" >> $GITHUB_OUTPUT
            echo "type=ë¬¸ì„œ" >> $GITHUB_OUTPUT
          elif [[ "$labels" == *"ğŸ¨ Design"* ]]; then
            echo "emoji=ğŸ¨" >> $GITHUB_OUTPUT
            echo "color=#e67e22" >> $GITHUB_OUTPUT
            echo "type=ë””ìì¸" >> $GITHUB_OUTPUT
          elif [[ "$labels" == *"âš™ï¸ Setting"* ]]; then
            echo "emoji=âš™ï¸" >> $GITHUB_OUTPUT
            echo "color=#9b59b6" >> $GITHUB_OUTPUT
            echo "type=ì„¤ì •" >> $GITHUB_OUTPUT
          else
            echo "emoji=ğŸ“" >> $GITHUB_OUTPUT
            echo "color=#3498db" >> $GITHUB_OUTPUT
            echo "type=ì¼ë°˜" >> $GITHUB_OUTPUT
          fi

      - name: Send Slack notification
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: |
            {
              "text": "${{ steps.label-emoji.outputs.emoji }} ìƒˆë¡œìš´ ì´ìŠˆê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!",
              "attachments": [
                {
                  "color": "${{ steps.label-emoji.outputs.color }}",
                  "fields": [
                    {
                      "title": "ì´ìŠˆ ì œëª©",
                      "value": "${{ github.event.issue.title }}",
                      "short": false
                    },
                    {
                      "title": "ì‘ì„±ì",
                      "value": "${{ github.event.issue.user.login }}",
                      "short": true
                    },
                    {
                      "title": "íƒ€ì…",
                      "value": "${{ steps.label-emoji.outputs.type }}",
                      "short": true
                    },
                    {
                      "title": "ë¼ë²¨",
                      "value": "${{ join(github.event.issue.labels.*.name, ', ') }}",
                      "short": false
                    },
                    {
                      "title": "ì´ìŠˆ ë§í¬",
                      "value": "<${{ github.event.issue.html_url }}|#${{ github.event.issue.number }}ì—ì„œ í™•ì¸í•˜ê¸°>",
                      "short": false
                    }
                  ],
                  "footer": "GitHub Issues",
                  "ts": ${{ github.event.issue.created_at }}
                }
              ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Notify on failure
        if: failure()
        uses: 8398a7/action-slack@v3
        with:
          status: failure
          text: "âŒ ì´ìŠˆ ì•Œë¦¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}